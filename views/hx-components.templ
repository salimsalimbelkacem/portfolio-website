package views

import (
	"time"
	"strconv"
	"github.com/salimsalimbelkacem/portfolio-website/views/github_repo"
)

var Routes = map[string]templ.Component{
	"projects":Projects(),
	"resume":Resume(),
	"tools":Tools(),
	"test":Test(),
	"about":About(),
}
templ Test(){
	<h1>test</h1>
}

var birth_date time.Time = time.Date(2004, 12, 31, 0, 0, 0, 0, time.UTC)

func calc_age(birth_date time.Time) (age time.Time){
	Now := time.Now()
	age = time.Date(Now.Year() - birth_date.Year(), Now.Month()-birth_date.Month(), Now.Day()-birth_date.Day(), 0, 0, 0, 0, time.UTC)
	return
}

templ Home(){ // it's a flex container !
	@About()
	@Tools()
}

var i int = 0;

func increment(by int) string{
	i = i + by
	return strconv.Itoa(i)
}

templ container( title, fst_add_styles, sec_div_add_styles string){
	<div class={"md:w-1/2 flex flex-col border-3 border-white my-2 md:my-0 mx-2 p-5" + fst_add_styles }id={"container-" + increment(1)}>
		<div class="flex justify-between relative">
			<h1 class="font-display-sans flex-shrink-0 mb-2 select-none">{title}</h1>

			<button class="cursor-pointer focus:[&>svg]:rotate-180 focus:[&+div]:max-h-50">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
					stroke-width="2" stroke="currentColor" class="size-10 transition-transform ease-out duration-300">
					<path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
				</svg>
			</button>

			<div class="right-0 top-10 *:text-lg *:m-2 flex flex-col absolute bg-black w-40 max-h-0 overflow-hidden transition-all duration-300 ease-in text-center">
				for _, title := range []string{"about", "projects", "resume", "tools", } {
					<button hx-get={"/hx/"+title} hx-swap="outerHTML" hx-target={"#container-"+increment(0)}>{title}</button>
				}
			</div>
		</div>

		<div class={ "min-h-0 overflow-y-scroll "+ sec_div_add_styles }> { children... } </div>
	</div>
}

templ About(){
	@container( "About me", "", "[&_br]:mb-4" ){
		<p class="px-4">
			My name is Salim Belkacem, I am {calc_age(birth_date).Format("06")} years old.
			I study computer science with a passion for software development 
			and cybersecurity. I love exploring new technologies and programming 
			languages. <br>

			I graduated with a bachelor degree in network infrastructure and cybersecurity,
			at Numidia Institute of Technology, Algiers, in july 2025. <br>

			During my time at NIT I was a member then co-manager in
			<a href="https://www.instagram.com/ncs._club/">the NCS scientific club.</a> 
			<br>

			Within it I most notably had the role of co-organizing a capture the flag event
			that went for 48 hours. With the help of the <a href="https://www.shellmates.club/">
			shellmates club</a> we crafted a serie of chalenges, and deployed them using docker
			on the cloud using google's services.
			<br>

			For a period of 7 weeks I was an intern among the soc team at
			<a href="https://unidees.dz">unidees</a> , and during that time I alongside my
			internship partner had the chance to learn about SIEMs, security and developed
			a deepseek wrapper for CIS remidiations that were detected inside a FOSS SIEM
			called wazuh, and presented the project as our end of study project {"for"} our
			bachelor.
			<br>

			//Please hire me.
		</p>
	}
}

type tools_ struct {
	Title string
	Icons []string
}

templ Tools(){
		@container("Tools I use","", "[&>div]:flex-wrap [&>div]:mb-10 px-4 [&>div]:px-4 [&>div]:flex [&>div]:gap-5"){
			for _, tools := range []tools_{ 
				{
					"programming Languages",
					[]string{ "python", "go", "c", "cplusplus", "javascript",
					"bash", "php", "java", "lua", "mysql",},
				},
				{
					"not programming Languages", []string{"css3", "html5", "markdown", },
				},
				{
					"libraries and frameworks", []string{"tailwindcss", "sass", "htmx",
					"nextjs", "react", "svelte", "flask", "numpy", "scikitlearn",
					"mongodb", "sdl", "hugo",},
				},
				{
					"devops", []string{"docker", "git", },
				},
				{
					"others", []string{"tmux", "figma", "gimp", "inkscape", "pfsense", },
				},
				{
					"editors and systems", []string{"archlinux", "debian", "neovim", "vim", },
				},
			}{
				<h2>{tools.Title}</h2>
				<div>
					for _, icon := range tools.Icons{
						<i title={icon} class={"devicon-"+ icon +"-plain"}></i>
					}
				</div>
			}
		<h2>I can't find icons of those</h2>
		<div class="mb-0">
			<ol>
			<li><a href="https://echo.labstack.com/">echo</a> (what i'm using for this website)</li>
			<li><a href="https://templ.guide/">templ</a> (this too)</li>
			<li><a href="https://wazuh.com/">wazuh</a></li>
			<li><a href="https://www.fortinet.com/products/siem/fortisiem">fortisiem</a></li>
			<li><a href="https://ollama.com/">ollama</a></li>
			</ol>
		</div>
		}
}

templ project_card( r githubrepo.Repo ){
// name, url, description, language
<div class="my-10">
	<h1><a href={r.Htmlurl}> {r.Name} </a></h1>
	<h2>{r.Descritption}</h2>
	<h4>{r.Language}</h4>
</div>
}

templ Projects(){
	@container("projects", "", "px-4"){
		<p>I am just listing repositories I own or colaborated in, that are hosted on github, the only notable project is the cis one ig</p>
		for _,repo := range githubrepo.GetReposList("salimsalimbelkacem"){
			@project_card(repo)
		}
	}
}

templ Resume(){
	@container("resume", "", "flex [&>a]:flex-1 [&_div]:h-40 [&_div]:bg-size-[100%_100%]"){
		<a href="/static/files/french.pdf" >
		<div class="bg-[url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.pixelstalk.net%2Fwp-content%2Fuploads%2F2016%2F07%2FFrench-Flag-HD-Image.png&f=1&nofb=1&ipt=b5041b87c07b3ff6a618578d3eef393d89c2ec62fd43ff1428eb5b1a4b520ad4)] "></div>
		</a>
		<a href="/static/files/english.pdf">
		<div class="bg-[url(https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fa.rgbimg.com%2Fusers%2Fk%2Fkn%2Fknox_x%2F600%2Fo5a4hGu.jpg&f=1&nofb=1&ipt=4955cc3dc2c754144fa6617bd17f138bd0f578391c71edf60ca7d39721513ad2)]"></div>

		</a>
	}
}
