package views

import (
	"time"
	"strconv"
	"github.com/salimsalimbelkacem/portfolio-website/views/github_repo"
)

var Routes = map[string]templ.Component{
	"projects":Projects(),
	"resume":Resume(),
	"tools":Tools(""),
	"test":Test(),
	"about":About(),
}
templ Test(){
	<h1>test</h1>
}

var birth_date time.Time = time.Date(2004, 12, 31, 0, 0, 0, 0, time.UTC)

func calc_age(birth_date time.Time) (age time.Time){
	Now := time.Now()
	age = time.Date(Now.Year() - birth_date.Year(), Now.Month()-birth_date.Month(), Now.Day()-birth_date.Day(), 0, 0, 0, 0, time.UTC)
	return
}

templ Home(){ // it's a flex container !
	@About()
	@Tools("hidden md:flex")
}

var i int = 0;

func increment(by int) string{
	i = i + by
	return strconv.Itoa(i)
}

templ container( title, fst_add_styles, sec_div_add_styles string){
	<div class={"border-3 dark:border-white my-2 md:my-0 " +
	"p-2 md:p-4 flex flex-1 flex-col gap-5 " +
	fst_add_styles }id={"container-" + increment(1)}>
		<div class="flex justify-between relative">
			<h2 class="shrink-0 select-none self-center">{title}</h2>

			<button class="cursor-pointer focus:[&>svg]:rotate-180 focus:[&+div]:max-h-50">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
					stroke-width="2" stroke="currentColor" class="size-10 transition-transform ease-out duration-300">
					<path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
				</svg>
			</button>

			<div class="right-0 top-12 *:text-lg *:m-2 flex flex-col absolute bg-white dark:bg-black w-40 max-h-0 overflow-hidden transition-all duration-300 ease-in text-center">
				for _, title := range []string{"about", "projects", "resume", "tools", } {
					<button hx-get={"/hx/"+title} hx-swap="outerHTML" hx-target={"#container-"+increment(0)}>{title}</button>
				}
			</div>
		</div>

		<div class={ "min-h-0 overflow-y-scroll overflow-x-scroll "+ sec_div_add_styles }> { children... } </div>
	</div>
}

templ About(){
	@container( "About me", "", "[&_br]:mb-10" ){
		<p class="text-4xl tracking-wider">
			My name is Salim Belkacem, I am {calc_age(birth_date).Format("06")} years old.
			I study computer science with a passion for software development.
			I love exploring new technologies and programming 
			languages. <br>

			I graduated with a bachelor degree in network infrastructure and cybersecurity,
			at Numidia Institute of Technology, Algiers, in july 2025. <br>

			During my time at NIT I was a member then co-manager in
			<a href="https://www.instagram.com/ncs._club/">the NCS scientific club.</a> 
			<br>

			Within it I most notably had the role of co-organizing a capture the flag event
			that went for 48 hours. With the help of the <a href="https://www.shellmates.club/">
			shellmates club</a> we crafted a serie of chalenges, and deployed them using docker
			and google cloud.
			<br>

			For a period of 7 weeks I was an intern among the soc team at
			<a href="https://unidees.dz">unidees</a> , and during that time I alongside my
			internship partner had the chance to learn about SIEMs, security and developed
			a deepseek wrapper for CIS remidiations that were detected inside a FOSS SIEM
			called wazuh, and presented the project as our end of study project {"for"} our
			bachelor.
			<br>

			I am now pursuing a masters degree in inteligent systems engineering (ISII)
			at the university of algiers 1.
			<br>
			//Please hire me.
		</p>
	}
}

type tools_ struct {
	Title string
	Icons []string
}

templ Tools(add_style string){
		@container("Tools I use", add_style, "[&>div]:flex-wrap [&>div]:mb-10 [&>div]:flex [&>div]:gap-5"){
			for _, tools := range []tools_{ 
				{
					"programming Languages",
					[]string{ "python", "go", "c", "cplusplus", "javascript",
					"bash", "php", "java", "lua", "mysql",},
				},
				{
					"not programming Languages", []string{"css3", "html5", "markdown", },
				},
				{
					"libraries and frameworks", []string{"tailwindcss", "sass", "htmx",
					"nextjs", "react", "svelte", "flask", "numpy", "scikitlearn",
					"mongodb", "sdl", "hugo",},
				},
				{
					"devops", []string{"docker", "git", },
				},
				{
					"others", []string{"tmux", "figma", "gimp", "inkscape", "pfsense", },
				},
				{
					"editors and systems", []string{"archlinux", "debian", "neovim", "vim", },
				},
			}{
				<h2>{tools.Title}</h2>
				<div>
					for _, icon := range tools.Icons{
						<i title={icon} class={"devicon-"+ icon +"-plain"}></i>
					}
				</div>
			}
		<h2>I can't find icons of those</h2>
		<div>
			<ol>
			<li><a href="https://echo.labstack.com/">echo</a></li>
			<li><a href="https://templ.guide/">templ</a></li>
			<li><a href="https://wazuh.com/">wazuh</a></li>
			<li><a href="https://www.fortinet.com/products/siem/fortisiem">fortisiem</a></li>
			<li><a href="https://ollama.com/">ollama</a></li>
			<li><a href="https://zdoom.org/wiki/ZScript">zscript</a> and <a href="https://zdoom.org/wiki/ACS">acs</a></li>
			</ol>
		</div>
		}
}

templ project_card( r githubrepo.Repo ){
// name, url, description, language
<div class="my-10">
	<h2><a href={r.Htmlurl}> {r.Name} </a></h2>
	<h3>{r.Descritption}</h3>
	<h4>{r.Language}</h4>
</div>
}

templ Projects(){
	@container("projects", "", ""){
		<p class="text-4xl  tracking-wider">repositories I own or colaborated in, that are hosted on github.</p>
		for _,repo := range githubrepo.GetReposList("salimsalimbelkacem"){
			@project_card(repo)
		}
	}
}

templ Resume(){
	@container("resume", "", "flex [&>a]:flex-1 [&_div]:h-40 [&_div]:bg-size-[100%_100%]"){
		<a href="/static/files/french.pdf" >
		<div class="bg-[url(/static/images/french_flag.png)] "></div>
		</a>
		<a href="/static/files/english.pdf">
		<div class="bg-[url(/static/images/english_flag.png)]"></div>

		</a>
	}
}
